<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>식사비 정산</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js">
        window.ANALYZE_URL = "{{ url_for('analyze_receipt') }}";
    </script>
  
</head>
<body>
    <div class="container">
        <h1>식사비 정산하기</h1>

        <div class="receipt-section">
            <h2>영수증으로 시작하기</h2>
            <div class="receipt-upload-area">
                <img id="receiptPreview" src="#" alt="영수증 미리보기" class="hidden"/>
                <div id="uploadPlaceholder">
                    <p>여기에 영수증 사진을 올려주세요</p>
                </div>
            </div>
            <input type="file" id="receiptUpload" accept="image/*" onchange="previewReceipt(event)" hidden>
            <div class="receipt-actions">
                <button type="button" class="upload-btn" onclick="document.getElementById('receiptUpload').click()">
                    📂 사진 선택
                </button>
                <button type="button" id="analyzeBtn" class="action-button analyze-btn" onclick="analyzeReceipt()" disabled>
                    🤖 AI로 분석하기
                </button>
            </div>
            <div id="loadingIndicator" class="hidden">
                <div class="spinner"></div>
                <p>영수증을 분석하고 있습니다...</p>
            </div>
        </div>

        <div class="divider">
            <span>또는</span>
        </div>

        <div class="total-amount-section">
            <label for="totalAmount">총 금액</label>
            <input type="number" id="totalAmount" placeholder="총 금액을 입력하세요" oninput="calculateSplit()">
            <span>원</span>
        </div>

        <div id="analysisResultSection" class="hidden">
            <h2>분석 결과</h2>
            <div class="settlement-choice">
                <label><input type="radio" name="settlement-type" value="split" checked onchange="toggleSettlementMode(this.value)"> 전체 금액 나누기</label>
                <label><input type="radio" name="settlement-type" value="select" onchange="toggleSettlementMode(this.value)"> 메뉴 선택해서 나누기</label>
            </div>
            <div id="menuSelectionSection" class="hidden">
                <div id="participantSelection"></div>
                <ul id="menuList"></ul>
            </div>
        </div>

        <div class="participants-section">
            <h2>참가자</h2>
            <div class="participant-add-form">
                <input type="tel" id="newParticipant" placeholder="휴대전화 번호 입력">
                <button onclick="addParticipant()">추가</button>
            </div>
            <ul id="participantList"></ul>
        </div>

        <div class="result-section">
            <p>참가 인원: <span id="participantCount">0</span>명</p>
        </div>

        <button class="action-button" onclick="sendKakaoTalkMessages()">카카오톡으로 정산 요청하기</button>
    </div>

    
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
